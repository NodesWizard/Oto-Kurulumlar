#!/bin/bash

echo -e "\033[0;35m"
echo "  _   _  ____  _____  ______  _______          _______ ______         _____  _____    ";
echo " | \ | |/ __ \|  __ \|  ____|/ ____\ \        / /_   _|___  /   /\   |  __ \|  __ \   ";
echo " |  \| | |  | | |  | | |__  | (___  \ \  /\  / /  | |    / /   /  \  | |__) | |  | |  ";
echo " | |\  | |__| | |__| | |____ ____) |  \  /\  /   _| |_ / /__ / ____ \| | \ \| |__| |  ";
echo " |_| \_|\____/|_____/|______|_____/    \/  \/   |_____/_____/_/    \_\_|  \_\_____/   ";
echo -e "\e[0m"
sudo su
sleep 2

# set vars
if [ ! $NODENAME ]; then
	read -p "Node Isminiz: " NODENAME
	echo 'export NODENAME='$NODENAME >> $HOME/.bash_profile
fi
STRIDE_PORT=16
if [ ! $WALLET ]; then
	echo "export WALLET=wallet" >> $HOME/.bash_profile
fi
echo "export STRIDE_CHAIN_ID=STRIDE-TESTNET-2" >> $HOME/.bash_profile
echo "export STRIDE_PORT=${STRIDE_PORT}" >> $HOME/.bash_profile
source $HOME/.bash_profile

echo '================================================='
echo -e "Node Isminiz: \e[1m\e[32m$NODENAME\e[0m"
echo -e "Cuzdan Isminiz: \e[1m\e[32m$WALLET\e[0m"
echo -e "Chain: \e[1m\e[32m$STRIDE_CHAIN_ID\e[0m"
echo -e "Port Numaraniz: \e[1m\e[32m$STRIDE_PORT\e[0m"
echo '================================================='
sleep 2

echo -e "\e[1m\e[32m1. Paketler Güncelleniyor... \e[0m" && sleep 1
# update
sudo apt update && sudo apt upgrade -y

echo -e "\e[1m\e[32m2. Bağımlılıklar Yükleniyor. \e[0m" && sleep 1
# packages
sudo apt install curl build-essential git wget jq make gcc tmux chrony -y

# install go
if ! [ -x "$(command -v go)" ]; then
  ver="1.18.2"
  cd $HOME
  wget "https://golang.org/dl/go$ver.linux-amd64.tar.gz"
  sudo rm -rf /usr/local/go
  sudo tar -C /usr/local -xzf "go$ver.linux-amd64.tar.gz"
  rm "go$ver.linux-amd64.tar.gz"
  echo "export PATH=$PATH:/usr/local/go/bin:$HOME/go/bin" >> ~/.bash_profile
  source ~/.bash_profile
fi

echo -e "\e[1m\e[32m3. Stride dosyasini indirmeye baslaniyor... \e[0m" && sleep 1
# download binary
cd $HOME
git clone https://github.com/Stride-Labs/stride.git
cd stride
git checkout 3cb77a79f74e0b797df5611674c3fbd000dfeaa1
make build
sudo cp $HOME/stride/build/strided /usr/local/bin

# config
strided config chain-id $STRIDE_CHAIN_ID
strided config keyring-backend test
strided config node tcp://localhost:${STRIDE_PORT}657

# init
strided init $NODENAME --chain-id $STRIDE_CHAIN_ID

# download genesis and addrbook
wget -qO $HOME/.stride/config/genesis.json "https://raw.githubusercontent.com/Stride-Labs/testnet/main/poolparty/genesis.json"

# set peers and seeds
SEEDS="c0b278cbfb15674e1949e7e5ae51627cb2a2d0a9@seedv2.poolparty.stridenet.co:26656"
PEERS="17b24705533d633cb3501233a18912ae6cc36a41@stride-testnet.nodejumper.io:28656,e26134d7d3e84c7a1129870d00060a03e68bb2a6@85.173.112.154:46656,1600b794c3727e5848efa593e16339789bad6320@116.203.41.7:16656,efb44e5336800b589053a13f2ee94d3d1cfe19d8@65.108.62.95:16656,d7d31e3477936e1ee2788f35604f8ff89a4d50ad@65.108.204.119:27656,9e6a79f2b53c0212a87de190075836f56b0c4f73@185.211.6.58:16656,f8c86373aeabc7908d3b24fa75d9c5ca38c5b345@143.244.189.163:16656,6b0775bcff26a3c4aebf9e1eeca243bd226f82e7@185.202.223.85:16656,88a34fcd6d7162e3f6063b3d618e496d6975c442@206.189.5.203:26656,f2d042a8887b76e15f913f8ff3617582a4c6f1d9@20.14.93.96:16656,8beff4429270515714b612425a99ea90423988d9@144.91.89.149:26656,5fdde3349b969ffc0095119d8ec438e6ff337804@65.109.0.10:16656,a061c212f279736c04cb553357f3867ab25ed21e@62.171.173.206:16656,35524a926fb5a57640e6a27dfae371d2be8f2daf@113.30.191.2:16656,1eabaeaaf37cc311a5e58054c838f604f03cd475@65.21.138.123:31656,b50d2f32008b12c10025e3f71f3f979451af2128@185.216.75.144:16656,625644ae7bc5d8b7d5269b78e83f6915fcafe4df@159.203.180.83:26656,ff701057233627a26780da214c14a66d932eef51@192.145.37.211:26656,fdcbb0a1d58e4bb934606abaa0e7eb9fc8ef3227@159.223.231.90:16656,4a48ddab8cabecd19427a3959484737a7e9e7bac@194.146.38.83:16656,1310dcdaac07d4427a48d17be58a4caa4905a5cb@188.166.72.156:16656,d22cef410b71890e2b8a5a0d88e1212b9d274b66@195.201.41.223:16656,b01bfd2272e0683501bd748f9291ee81d74e242f@159.65.51.99:16656,14d91d597eb59c948d8eb4a1803f5e11011cb1f0@185.167.98.119:16656,d7085dc8e59bea405409bdf138f9fdd3cedba4ec@161.97.78.233:16656,10fe01afc27fea33c7d1357ff92b26111707630c@149.102.137.255:16656,d6d45352df7a280225ff4a7e1d43659090ee85ef@49.12.214.194:16656,7516f8c0ac2e9f6113e4a5599ec3a1fbf8f55c0c@154.53.63.157:26656,2c6dc6e8a4d4158643e2ec2abec1a4305c22bd86@20.25.184.102:16656,6c936f80e46843748e669b530d9c7a144d04f683@164.92.208.60:16656,0451f89d285424752fe6decf8f26e7468492fb9a@135.181.98.172:16656,8ae9de56c2e50617d117fda4e1d0164f28180e03@109.107.182.205:26656,4c597b86679715fb9fb5a78510ec0b4aa95114cf@65.21.159.38:16656,a89a236e03f71d05695b88d76fdf85669ccc0d94@20.82.176.58:16656,837d7012de307462cd68c92752680abba0cbff3a@172.104.232.210:16656,2945d28470b991c3b0e78286f580e47ba42b966d@5.161.135.12:26656,74102803e23ffe7d042f25eeb3c85004cee4929a@62.113.112.235:16656,650d124d4d4ebb64971488f3f64d3bd63368d20e@38.242.242.193:28656,38b1f2aba2e4e2a8d44a714f050e796d25123a0f@2.58.82.107:16656,f7e240ea5722083f8dcbcbf33f3d8246257c6b11@185.202.223.124:16656,59bd2e026f6597ceba250779b991ee55fb49cfdc@51.195.145.100:26656,1db799c536fa99d40b7b497c29df8f44834a8a1d@194.5.152.107:26656,b1b9e8e68ed34ecf7556ffc90f1ccd4076dc99b6@185.202.223.58:16656,8071611b00cacb8d6a71c1916b9045f70fc3b0ca@135.181.202.21:16656,a2d09d89b81dfbca692f5c56c4f8fa1334dec5aa@5.161.84.1:12656,bda433a00b024e9407664e63209441bf8a583f6d@149.102.131.134:16656,f2e0b3fd0479a25706e7f1565d7ba971e2904ca9@86.48.1.149:16656,1a873c429f87010654e34ccc74d7b487fb9d2c2e@139.162.58.187:16656,ec76b749d347407c1451c26088fca2ccca269344@20.127.193.191:16656,806098a55f676f8cc591e661d854e1e20c862538@45.151.123.97:16656,2a6516ce7462f129e6dfbdbe6390884da6b9595c@86.48.5.211:26656,7ae3b00c50b17ec306db84155665bf7c598251d2@178.18.240.171:26656,d23db42be239230cb24265a03c55e58b472df2b4@38.242.141.34:26656,e6ce776d70ce7fa0797549c37ebfc45b7833ea99@194.163.159.100:16656,2d145db8d1210ee4b30717cfee56a4bb90663730@80.190.129.50:26656,2c324736ba6f7dfef00f7f0aa355514d3ccdf4dc@185.245.183.106:16656,d9d51e629d1dd27c9eba82d1e967e5b965b1932c@131.255.179.6:16656,acc291258810e829db87a8babfa22cf82e217caa@141.147.7.113:26656,831adfd1e4b9b5bae0598422064508f809478156@192.145.37.4:16656,4a549dccd2b3b6805a80573ae4339c8482093744@45.94.58.107:16656,2d94446454cd1423b365e776052be11e5531ae8c@154.53.59.87:16656,6ccbf9501ddb85061ee01b96f5576f6064bd66de@146.190.52.217:16656,70fa92f8eead0b0e9d428145dbb44716f6554460@38.242.241.79:26656,4cead31d5bd4f4d89d585a49e951e9937abc2074@95.216.197.192:26656,d3e9d44ae71ee37789f8241fb498482ee3996741@34.132.211.188:26656,d5ab0580725089d2517ba1884c825af7e3b0c110@86.48.2.10:26656,afa8499cdca063885e13869c5dc871d2e79657a6@20.224.66.164:26656,f140d5598a678c95bd0a7586cfd2be4926146dbf@178.18.241.60:16656,62853c1b7216c2d741dbe7ddaca3a8e66af6ee19@51.13.80.45:16656,f871774836f2b5792d8795b97799bb14c4364510@65.109.24.222:26656,867d83ac0bd55ef265b89fc2e4ee35e3e9daaed0@194.163.167.174:26656,7a1fbc65e3e9094458d9b8a831bd6d6721cb8996@137.184.121.240:16656,9bc8a7ba4189a389e3a2adc404b903becb15053c@212.86.105.63:16656,08d4957228eec1e165d6cbf65ef9759eada7d9f1@65.108.132.239:26657,8c08e9e09d902d3e315a4fb645d9802f5d1ea525@66.94.123.169:16656,4db980684681c40e460f65f7c0467d321e4c68cb@209.126.7.240:16656,474ea99576abadd694a4d8ec38907f6c26ec66ab@38.242.159.170:26656,ec9dcd9601d17f4f1ec880bde9a9052b6e6d8230@20.84.76.87:26656,077d760498e5b93543c17d2b665c13923f2672cf@173.249.33.184:26656,473e793fd83537fd2f6e8228af85f5904294b770@144.91.103.211:26656,82a8e91d408a2571997538c12762c41b6f286f2c@38.242.129.80:16656,f7d27705738a548cfee1604f3f7023e6b9a5e033@193.46.243.52:16656,6e6003026e02c7848baad66657c0bd4aaef797fa@159.223.190.247:16656,c526743405b82b31ca5c86f64cffe6701436b741@20.106.160.81:16656,6dca2636528b18c0fd245849d61f0c0a0f266711@206.189.10.97:26656,f3848b9ae2b8c3e15eafbd8c54a90f404ce75e42@51.142.95.40:16657,a00f7ca57ba6c4e2f37cfc89fc30d0f518bb65bf@38.242.217.55:26656,338df0633493b98e748506195cd35a6acaee657b@65.109.14.110:16656,72e24dbf0f7487ea74973bd418a59664b52d8814@38.242.159.133:16656,c761cf5f832a67bb981f442f98389e343fdd0b32@209.145.62.91:26656,e718e156dbc1b6644653debece7552de9a3f670f@185.220.205.98:16656,ac106538e2a35731eb5c1c14a4af79624ffd6a7e@154.53.51.114:26656,fe70b9b4794949faea29de286e8e75fdc218a375@95.214.55.131:23656,f0c7aaa7bcd159e4fe2775abc5968e3548af866d@34.135.153.30:16656,4d55aa87e236a93667d4959b8bde72ad941acf20@35.199.179.246:26656,cb768beaf58f3abeb57309ef945409ab497d27ea@159.223.19.111:26656,35df358015e24343056e94dddcd060d92092336b@95.179.181.60:26656,38ad63e507249b7c4995a20f16525c33e57f6ab1@135.181.202.46:16656,ba78e32d254ded123d39c0ab4da572c87a914acd@20.238.85.72:16656,42973555e8c9361589e67d935157e8231c9c7aef@95.217.7.124:26656,a107cdd95e44af126bebd5fbd81b04b9b2e3fb84@34.125.25.95:16656,2d105024b8d9e5be9f4f86ab2ea4bc8219ecbdeb@34.105.40.186:26656,8acff5bc80a9d286721d540047c53f7ad0d54f2b@95.216.153.211:16656,6ef759856b914f608bb2095fe8ce413b0d2754d3@116.203.41.53:16656,fef42f7a0197323cafad8cdcb45f70171a48a2d8@149.102.128.248:16656,2258862905ff388d9823b71852b3d9ab4303e2b8@65.21.149.33:16656,a3be3e353e33119318a4c1e9ff96cdf89b4c8810@130.255.170.151:36656,6b4d37810b8b274e4b6a652e85532524d29c22d9@162.55.27.100:16656,cbe10f6b514b79153529e7109b51c7d6d22702c1@23.97.243.232:16656,0230fddfc03470919f2872660ca5c44d96763cb9@185.16.39.156:26656,1280960b12b397b193ca34efb4841e5ce9eb5521@125.212.225.216:26656,5ad37c1da50947f16d3a79f638a1b3b4e77c0adb@38.242.206.64:26656,088aa929d49ade336e90f6045f2c0788047c4550@95.216.174.250:16656,fc8181e8d1c3349156988c67954aec6f8f470d25@194.146.25.9:26656,b81507452f4424bea64ca5dac0c59b0820df8e0f@13.76.86.97:16656,78a957a3ed5bc6146895793bbfa8142bd6da140b@65.108.95.140:26656,34e943bbbe85feea55bb1e577baf2984f7d96ef1@135.181.81.224:16656,6d32a819538137ca732a4e8688f96a4e5f79be1a@161.97.173.154:26656,c2e95d8cced2e614bd7bf07fce0f61de03965b72@109.205.181.114:26656,8d9d86646627588c485149b82130e1bcacf88fec@65.109.12.201:16656,f6e804d1d509db730de171cf1d0553d701c5140f@142.132.235.215:16656,f2cdde1fbeb7c6850c35754670f87286fc7ad3c9@84.21.171.166:16656,fef5a04c72fb967e4271d0d73cfa8a87234b0dd3@95.217.155.89:16656,ef58f3c3e224eb79f36a199079586fa29f1e3d26@20.239.50.33:26656,556e7557a407f8ab8a30299c4e077a975de8b2cd@185.169.252.51:26656,1c06803eb8dda04473f2a5d8419f26126d6d1b09@89.58.45.204:26656,127dc178fec9ffbcf922fca3fa82a03b8f58d74d@159.223.137.215:16656,b286fad96d6459626af1d2be7685daf22dbbace3@154.53.63.156:26656,c116bfd0e8617334d61e2ee452f061f0ba1c30db@65.109.1.177:16656,5498ddb890f5185cde88b934d05b82dc692ebadd@95.217.207.236:26656,eed799e75897cdacd4c7c9379441cb50a4d82a79@144.91.76.134:16656,05875d98badcca55a96b287a24579ecfae13254a@194.163.184.84:16656,c0899bac48cf69f3cf353fc7de70195f7d2b55b4@185.211.5.245:26656,abdca3e7e110b9f54f2c41e82205f403b5693f5f@40.113.161.37:16656,1d37c860762b1d7a54cae45f5214a5563cc5f0d7@62.171.158.97:26656,8b1261901fa98c33f00749b37d5e3ce1949cf0af@34.171.239.198:16656,b0e2f3554414a677a1cb61ba872385e935f91339@109.205.181.106:26656,f7984fa4c336a8e963c49e3f5e83ac6cf642a546@34.170.235.202:16656,c74b86515f60f8c1391d45b2af510accdc6b2ace@109.205.181.23:16656,4c84528b3db8774daadaa69772b2139594491152@37.120.178.232:26656,4894863befa8edb312608c2ffc3429a96873586d@116.202.112.175:16656,240a191f96019e4c66eaaa9f0d8b633650089f2e@207.244.237.70:16656,8caa148cb7b67cf95f5b9b13258b74e5c4cdf260@207.180.202.118:16656,f96fb1eac5ba57d226b83814aefe7c2a08639e25@135.181.89.127:26656,8f02009acb9d97f255cae8dd0334e2d782f141fe@5.9.13.162:20086,74852aa59840ee11cb6041b534a2878d6633aa79@159.89.26.53:16656,7b7c3e0430dbadf78d9953f7c486235e21528223@132.145.203.156:16656,0ab3f6b387e6957cd32880fa1788835e8a6acb8f@34.89.108.215:16656,144a1b68c6d974d4904b641d8232419959386e0e@95.216.218.102:26656,0da0e2430affea1aee067af66f6303c7e4828cdf@194.163.153.251:26656,5afe169dabd1436b275bf9192d366d930e604c00@157.245.251.191:16656,8dd9e655cfec60fb2e55a5d9dcaa12ec48902b9e@165.227.94.215:26656,70c4166c29e020d6108089c0af34d2e7cfc0524d@185.245.183.84:26656,808fc00a9044cabcae5fd5dffd0c5968a2dea4d7@20.11.16.72:16656,4a81305d77020755355885dc89bf652a3c3d5c0c@185.219.82.252:16656,c97299e5ed0c6ad0ca405001f528317e0d9b0970@159.203.191.62:26656,99e73ea1dbb9914c80010294077df057b7c3add8@65.108.121.239:26656,254ee937ac9139b0a841efcb2c93bf8370dac0fa@159.89.88.89:26656,46cae9893a38574348e8241fdefe5e9f5c71b2bf@149.102.138.67:26956,c55407be7ea55b593a0ee58195112dfe8b6545cb@20.254.149.43:16656,22c0fdb4ba967e4cb1edfc00ca258a9f5fa32db9@135.181.75.42:26656,89ed06e123fcd23953f80ac8952d9ccff13b900f@135.181.88.74:16656,d8e4c3814cf4904c8055e7f826c1ab02e852e602@38.242.243.214:26656,bfc58b649144fae79dcb94d44197a6e33b6a74b0@38.242.234.84:16656,92b30d74b43841ae28a1892d3777e81632ff1903@194.180.176.176:26656,56dceaae59c6f272ef4957b246069af076347701@66.94.115.139:16656,9a2e21e87b3b7cd7fbedb277210b768636ff0453@65.21.248.203:16656,d6dca1db2d6a805df702860f00c18f2a382f1c42@95.217.156.221:26656,bfa14e22541238143c41d10ef019392eb72b2b30@38.242.212.126:16656,6cd4368f972c8e70f39f159804d2b0c89d603b7b@115.73.213.74:26656,f93ce5616f45d6c20d061302519a5c2420e3475d@135.125.5.31:54356,d903633a8597b3d5c72331b5142beb74ba2141dd@213.231.8.42:26656,a5d7f42271d620caab9092c31471fe0875dcbc2b@104.248.205.105:16656,c2c71e6e5b739040ed627240e6a85289b0c0d1ac@185.167.99.21:16656,1b5d28b41cb80532a4b50874e1707eb7c7ee82fd@144.126.149.19:26656,17d3bf8d0d7d66999e74b43b43073a875f52560d@34.136.142.29:16656,e47af4bea9322616a9da25cab6c9ebf53febeb45@2.59.156.119:16656,734171487afc0419354f7b51e2d8d42ea445619d@38.242.139.231:26656,950818e6b5800589453d52955c014380ed085bed@194.163.152.184:26656,0ca7cc2999175d62476e17c9ae346846d294d993@46.101.13.182:16656,777823448fde8e86955de58c770ed7508ccad94a@194.163.152.25:16656,4bec2c538865e6b8cf846bff6ded1fe647b4e330@38.242.234.61:16656,7b650b34cfb58e512ffc6b160549773a7f421a8e@45.91.168.30:16656,6920aeb067f217cea315e817f6d470fae7781f02@95.216.161.242:16656,ba7765c593245fe5dd1635c245c1951bc5575b8d@185.185.80.167:16656,ad0910ba98a2934b6c2ddd0f9e02a435a4c5c917@65.108.147.82:26656,4cdab44232f0f614249e41480c836252fa13d417@176.9.35.125:24756,fdc2311f27e12697e5b3e6b095756ffa35ec0005@65.21.129.95:26656,76dfdec69df1be39311e771999cc9264002c014f@77.92.132.67:26656,7df93c9be622fdeb268c562bd56c305acf021320@38.242.153.6:26656,2b7f31bc0d4e832455115405df8fe5b5b60b1351@125.212.225.198:26656,5fdb125764d994001d6938580f2b616f7ebae203@20.243.169.252:16656,c0fcd7b454c52e4fb7d948382f1c47f8f1032751@178.62.224.141:26656,2cdbaca48e8dfba1328ae46007a990b6a24113d3@198.13.55.12:26656,89f61fc557ed207a4226198598203d23652affcb@65.21.193.112:26656,1571d08ad360e04c7096a843c587ae8b84f37e73@161.97.169.193:26656,71b5d017611bda00af2bddcf0bf4f597baf556eb@158.101.166.214:16656,d18390a2d9a9ff8501d8fb9488520a6f4eba0f84@20.62.112.138:16656,14eec22bdcd20455e87bd013a4ec4715276f4a3f@46.101.97.31:16656,9ebb9216dcb405035f25dbc25cdd9e98c283da7f@46.101.53.44:16656"
sed -i -e "s/^seeds *=.*/seeds = \"$SEEDS\"/; s/^persistent_peers *=.*/persistent_peers = \"$PEERS\"/" $HOME/.stride/config/config.toml

# set custom ports
sed -i.bak -e "s%^proxy_app = \"tcp://127.0.0.1:26658\"%proxy_app = \"tcp://127.0.0.1:${STRIDE_PORT}658\"%; s%^laddr = \"tcp://127.0.0.1:26657\"%laddr = \"tcp://127.0.0.1:${STRIDE_PORT}657\"%; s%^pprof_laddr = \"localhost:6060\"%pprof_laddr = \"localhost:${STRIDE_PORT}060\"%; s%^laddr = \"tcp://0.0.0.0:26656\"%laddr = \"tcp://0.0.0.0:${STRIDE_PORT}656\"%; s%^prometheus_listen_addr = \":26660\"%prometheus_listen_addr = \":${STRIDE_PORT}660\"%" $HOME/.stride/config/config.toml
sed -i.bak -e "s%^address = \"tcp://0.0.0.0:1317\"%address = \"tcp://0.0.0.0:${STRIDE_PORT}317\"%; s%^address = \":8080\"%address = \":${STRIDE_PORT}080\"%; s%^address = \"0.0.0.0:9090\"%address = \"0.0.0.0:${STRIDE_PORT}090\"%; s%^address = \"0.0.0.0:9091\"%address = \"0.0.0.0:${STRIDE_PORT}091\"%" $HOME/.stride/config/app.toml

# config pruning
pruning="custom"
pruning_keep_recent="100"
pruning_keep_every="0"
pruning_interval="50"
sed -i -e "s/^pruning *=.*/pruning = \"$pruning\"/" $HOME/.stride/config/app.toml
sed -i -e "s/^pruning-keep-recent *=.*/pruning-keep-recent = \"$pruning_keep_recent\"/" $HOME/.stride/config/app.toml
sed -i -e "s/^pruning-keep-every *=.*/pruning-keep-every = \"$pruning_keep_every\"/" $HOME/.stride/config/app.toml
sed -i -e "s/^pruning-interval *=.*/pruning-interval = \"$pruning_interval\"/" $HOME/.stride/config/app.toml

# set minimum gas price and timeout commit
sed -i -e "s/^minimum-gas-prices *=.*/minimum-gas-prices = \"0ustrd\"/" $HOME/.stride/config/app.toml

# enable prometheus
sed -i -e "s/prometheus = false/prometheus = true/" $HOME/.stride/config/config.toml

# reset
strided tendermint unsafe-reset-all --home $HOME/.stride

echo -e "\e[1m\e[32m4. Servis Baslatiliyor... \e[0m" && sleep 1
# create service
sudo tee /etc/systemd/system/strided.service > /dev/null <<EOF
[Unit]
Description=stride
After=network-online.target
[Service]
User=$USER
ExecStart=$(which strided) start --home $HOME/.stride
Restart=on-failure
RestartSec=3
LimitNOFILE=65535
[Install]
WantedBy=multi-user.target
EOF

# start service
sudo systemctl daemon-reload
sudo systemctl enable strided
sudo systemctl restart strided


sleep 5
echo -e "\e[1m\e[32m5. SNAPSHOT ATILIYOR [NodesWizard.Com] \e[0m" && sleep 1
sudo apt install lz4 -y
sudo systemctl stop strided
strided tendermint unsafe-reset-all --home $HOME/.stride --keep-addr-book
sleep 1
cd $HOME/.stride
rm -rf data 
sleep 1
SNAP_NAME=$(curl -s https://snapshots2-testnet.nodejumper.io/stride-testnet/ | egrep -o ">STRIDE-TESTNET-2.*\.tar.lz4" | tr -d ">")
curl https://snapshots2-testnet.nodejumper.io/stride-testnet/${SNAP_NAME} | lz4 -dc - | tar -xf -
sleep 1
sudo systemctl restart strided

echo -e "\e[1m\e[32m6. 155.420 AG GUNCELLEMESI YAPILIYOR [NodesWizard.Com] \e[0m" && sleep 1
sudo systemctl stop strided
cd $HOME && rm -rf stride
git clone https://github.com/Stride-Labs/stride.git && cd stride
git checkout 4ec1b0ca818561cef04f8e6df84069b14399590e
make build
sudo mv build/strided $(which strided)
sudo systemctl restart strided

echo -e "\e[1m\e[32m7. KURULUM BITTI [NodesWizard.Com] \e[0m" && sleep 1
echo -e 'Log Kontrol: \e[1m\e[32mjournalctl -u strided -f -o cat\e[0m'
echo -e "Sync Status: \e[1m\e[32mcurl -s localhost:${STRIDE_PORT}657/status | jq .result.sync_info\e[0m"
